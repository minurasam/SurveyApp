"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _uri = require("../uri");

var NID$ = "(?:[0-9A-Za-z][0-9A-Za-z\\-]{1,31})";
var PCT_ENCODED$ = "(?:\\%[0-9A-Fa-f]{2})";
var TRANS$$ = "[0-9A-Za-z\\(\\)\\+\\,\\-\\.\\:\\=\\@\\;\\$\\_\\!\\*\\'\\/\\?\\#]";
var NSS$ = "(?:(?:" + PCT_ENCODED$ + "|" + TRANS$$ + ")+)";
var URN_SCHEME = new RegExp("^urn\\:(" + NID$ + ")$");
var URN_PATH = new RegExp("^(" + NID$ + ")\\:(" + NSS$ + ")$");
var URN_PARSE = /^([^\:]+)\:(.*)/;
var URN_EXCLUDED = /[\x00-\x20\\\"\&\<\>\[\]\^\`\{\|\}\~\x7F-\xFF]/g; //RFC 2141

var handler = {
  scheme: "urn",
  parse: function parse(components, options) {
    var matches = components.path && components.path.match(URN_PARSE);
    var urnComponents = components;

    if (matches) {
      var scheme = options.scheme || urnComponents.scheme || "urn";
      var nid = matches[1].toLowerCase();
      var nss = matches[2];
      var urnScheme = "".concat(scheme, ":").concat(options.nid || nid);
      var schemeHandler = _uri.SCHEMES[urnScheme];
      urnComponents.nid = nid;
      urnComponents.nss = nss;
      urnComponents.path = undefined;

      if (schemeHandler) {
        urnComponents = schemeHandler.parse(urnComponents, options);
      }
    } else {
      urnComponents.error = urnComponents.error || "URN can not be parsed.";
    }

    return urnComponents;
  },
  serialize: function serialize(urnComponents, options) {
    var scheme = options.scheme || urnComponents.scheme || "urn";
    var nid = urnComponents.nid;
    var urnScheme = "".concat(scheme, ":").concat(options.nid || nid);
    var schemeHandler = _uri.SCHEMES[urnScheme];

    if (schemeHandler) {
      urnComponents = schemeHandler.serialize(urnComponents, options);
    }

    var uriComponents = urnComponents;
    var nss = urnComponents.nss;
    uriComponents.path = "".concat(nid || options.nid, ":").concat(nss);
    return uriComponents;
  }
};
var _default = handler;
exports["default"] = _default;