"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === "[object Arguments]")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function isSecure(wsComponents) {
  return typeof wsComponents.secure === 'boolean' ? wsComponents.secure : String(wsComponents.scheme).toLowerCase() === "wss";
} //RFC 6455


var handler = {
  scheme: "ws",
  domainHost: true,
  parse: function parse(components, options) {
    var wsComponents = components; //indicate if the secure flag is set

    wsComponents.secure = isSecure(wsComponents); //construct resouce name

    wsComponents.resourceName = (wsComponents.path || '/') + (wsComponents.query ? '?' + wsComponents.query : '');
    wsComponents.path = undefined;
    wsComponents.query = undefined;
    return wsComponents;
  },
  serialize: function serialize(wsComponents, options) {
    //normalize the default port
    if (wsComponents.port === (isSecure(wsComponents) ? 443 : 80) || wsComponents.port === "") {
      wsComponents.port = undefined;
    } //ensure scheme matches secure flag


    if (typeof wsComponents.secure === 'boolean') {
      wsComponents.scheme = wsComponents.secure ? 'wss' : 'ws';
      wsComponents.secure = undefined;
    } //reconstruct path from resource name


    if (wsComponents.resourceName) {
      var _wsComponents$resourc = wsComponents.resourceName.split('?'),
          _wsComponents$resourc2 = _slicedToArray(_wsComponents$resourc, 2),
          path = _wsComponents$resourc2[0],
          query = _wsComponents$resourc2[1];

      wsComponents.path = path && path !== '/' ? path : undefined;
      wsComponents.query = query;
      wsComponents.resourceName = undefined;
    } //forbid fragment component


    wsComponents.fragment = undefined;
    return wsComponents;
  }
};
var _default = handler;
exports["default"] = _default;