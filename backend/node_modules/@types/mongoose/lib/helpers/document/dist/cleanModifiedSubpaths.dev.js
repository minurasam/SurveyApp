'use strict';
/*!
 * ignore
 */

module.exports = function cleanModifiedSubpaths(doc, path, options) {
  options = options || {};
  var skipDocArrays = options.skipDocArrays;
  var deleted = 0;

  if (!doc) {
    return deleted;
  }

  for (var _i = 0, _Object$keys = Object.keys(doc.$__.activePaths.states.modify); _i < _Object$keys.length; _i++) {
    var modifiedPath = _Object$keys[_i];

    if (skipDocArrays) {
      var schemaType = doc.$__schema.path(modifiedPath);

      if (schemaType && schemaType.$isMongooseDocumentArray) {
        continue;
      }
    }

    if (modifiedPath.startsWith(path + '.')) {
      delete doc.$__.activePaths.states.modify[modifiedPath];
      ++deleted;
    }
  }

  return deleted;
};