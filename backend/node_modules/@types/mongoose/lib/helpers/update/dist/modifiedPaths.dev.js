'use strict';

var _modifiedPaths = require('../common').modifiedPaths;
/**
 * Given an update document with potential update operators (`$set`, etc.)
 * returns an object whose keys are the directly modified paths.
 *
 * If there are any top-level keys that don't start with `$`, we assume those
 * will get wrapped in a `$set`. The Mongoose Query is responsible for wrapping
 * top-level keys in `$set`.
 *
 * @param {Object} update
 * @return {Object} modified
 */


module.exports = function modifiedPaths(update) {
  var keys = Object.keys(update);
  var res = {};
  var withoutDollarKeys = {};

  for (var _i = 0, _keys = keys; _i < _keys.length; _i++) {
    var key = _keys[_i];

    if (key.startsWith('$')) {
      _modifiedPaths(update[key], '', res);

      continue;
    }

    withoutDollarKeys[key] = update[key];
  }

  _modifiedPaths(withoutDollarKeys, '', res);

  return res;
};