"use strict";

var assert = require('assert');

var clone = require('../');

describe('regexp-clone', function () {
  function hasEqualSource(a, b) {
    assert.ok(a !== b);
    assert.equal(a.source, b.source);
  }

  function isIgnoreCase(a) {
    assert.ok(a.ignoreCase);
  }

  function isGlobal(a) {
    assert.ok(a.global);
  }

  function isMultiline(a) {
    assert.ok(a.multiline);
  }

  function isDotAll(a) {
    assert.ok(a.dotAll);
  }

  function isUnicode(a) {
    assert.ok(a.unicode);
  }

  function isSticky(a) {
    assert.ok(a.sticky);
  }

  function testFlag(a, method) {
    var b = clone(a);
    hasEqualSource(a, b);
    method(a);
    method(b);
  }

  function lastIndex(a) {
    a.test('this string hi there');
    assert.strictEqual(a.lastIndex, 3);
    var b = clone(a);
    assert.strictEqual(b.lastIndex, 3);
    assert.strictEqual(a.lastIndex, 3);
    b.test('this string hi there');
    assert.strictEqual(b.lastIndex, 14);
    assert.strictEqual(a.lastIndex, 3);
  }

  function allFlags(a) {
    var b = clone(a);
    hasEqualSource(a, b);
    testFlag(b, isIgnoreCase);
    testFlag(b, isGlobal);
    testFlag(b, isMultiline);
    testFlag(b, isDotAll);
    testFlag(b, isUnicode);
    testFlag(b, isSticky);
  }

  function noFlags(a) {
    var b = clone(a);
    hasEqualSource(a, b);
    assert.ok(!b.ignoreCase);
    assert.ok(!b.global);
    assert.ok(!b.multiline);
    assert.ok(!b.dotAll);
    assert.ok(!b.unicode);
    assert.ok(!b.sticky);
  }

  describe('literals', function () {
    it('ignoreCase flag', function (done) {
      var a = /hello/i;
      testFlag(a, isIgnoreCase);
      done();
    });
    it('global flag', function (done) {
      var a = /hello/g;
      testFlag(a, isGlobal);
      done();
    });
    it('multiline flag', function (done) {
      var a = /hello/m;
      testFlag(a, isMultiline);
      done();
    });
    it('dotAll flag', function (done) {
      var a = /hello/;
      testFlag(a, isDotAll);
      done();
    });
    it('unicode flag', function (done) {
      var a = /hello/;
      testFlag(a, isUnicode);
      done();
    });
    it('sticky flag', function (done) {
      var a = new RegExp("hello", "y");
      testFlag(a, isSticky);
      done();
    });
    it('no flags', function (done) {
      var a = /hello/;
      noFlags(a);
      done();
    });
    it('all flags', function (done) {
      var a = new RegExp("hello", "gimsuy");
      allFlags(a);
      done();
    });
    it('lastIndex', function (done) {
      var a = /hi/g;
      lastIndex(a);
      done();
    });
  });
  describe('instances', function () {
    it('ignoreCase flag', function (done) {
      var a = new RegExp('hello', 'i');
      testFlag(a, isIgnoreCase);
      done();
    });
    it('global flag', function (done) {
      var a = new RegExp('hello', 'g');
      testFlag(a, isGlobal);
      done();
    });
    it('multiline flag', function (done) {
      var a = new RegExp('hello', 'm');
      testFlag(a, isMultiline);
      done();
    });
    it('dotAll flag', function (done) {
      var a = new RegExp('hello', 's');
      testFlag(a, isDotAll);
      done();
    });
    it('unicode flag', function (done) {
      var a = new RegExp('hello', 'u');
      testFlag(a, isUnicode);
      done();
    });
    it('sticky flag', function (done) {
      var a = new RegExp('hello', 'y');
      testFlag(a, isSticky);
      done();
    });
    it('no flags', function (done) {
      var a = new RegExp('hmm');
      noFlags(a);
      done();
    });
    it('all flags', function (done) {
      var a = new RegExp('hello', 'misguy');
      allFlags(a);
      done();
    });
    it('lastIndex', function (done) {
      var a = new RegExp('hi', 'g');
      lastIndex(a);
      done();
    });
  });
});